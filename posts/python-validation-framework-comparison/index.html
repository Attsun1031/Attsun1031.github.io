<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Pythonスキーマバリデーションライブラリ比較 (pydantic, marshmallow, attrs, cerberus) - Attsun blog</title><link rel=icon type=image/png href=icons/myicon.png><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="Pythonスキーマバリデーションライブラリ比較 (pydantic, marshmallow, attrs, cerberus)"><meta property="og:description" content="Pythonスキーマバリデーションライブラリについて比較してみました。"><meta property="og:type" content="article"><meta property="og:url" content="https://attsun1031.github.io/posts/python-validation-framework-comparison/"><meta property="article:published_time" content="2021-01-16T12:49:44+09:00"><meta property="article:modified_time" content="2021-01-16T12:49:44+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Pythonスキーマバリデーションライブラリ比較 (pydantic, marshmallow, attrs, cerberus)"><meta name=twitter:description content="Pythonスキーマバリデーションライブラリについて比較してみました。"><link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://attsun1031.github.io/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://attsun1031.github.io/css/main.css><link rel=stylesheet type=text/css href=https://attsun1031.github.io/css/custom.css><script src=https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js></script><script src=https://attsun1031.github.io/js/main.js></script></head><body><div class="container wrapper post"><div class=header><base href=https://attsun1031.github.io/><h1 class=site-title><a href=https://attsun1031.github.io/>Attsun blog</a></h1><div class=site-description><h2></h2><nav class="nav social"><ul class=flat><a href=https://github.com/Attsun1031 title=Github><i data-feather=github></i></a><a href=https://twitter.com/__Attsun__ title=Twitter><i data-feather=twitter></i></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>Home</a></li><li><a href=/posts>All posts</a></li><li><a href=/about>About</a></li><li><a href=/tags>Tags</a></li></ul></nav></div><div class=post-header><h1 class=title>Pythonスキーマバリデーションライブラリ比較 (pydantic, marshmallow, attrs, cerberus)</h1><div class=meta>Posted at &mdash; Jan 16, 2021</div></div><div class=markdown><p>ウェブAPIの作成など、外部からやってくるデータを安全に捌く上で、スキーマ定義とバリデーションは非常に重要です。</p><p>また、特にPythonのような動的型付け言語において、内部でもレイヤをまたぐ場合はきちんと定義されたデータモデルを利用することで、知らない間にデータモデルが変わっていた、というようなケースを防ぐことができます。</p><p>Pythonには標準でスキーマバリデーションライブラリがないため3rdパーティのものを使うことになりますが、様々なライブラリがあるので比較してみました。</p><h1 id=比較対象のライブラリ概要>比較対象のライブラリ概要</h1><p>※Pythonバージョンは3.9.0を利用します。</p><table><thead><tr><th style=text-align:left>lib                    </th><th>version</th><th>Github Star<br>(2020/1/5)</th><th>memo</th></tr></thead><tbody><tr><td style=text-align:left><a href=https://pydantic-docs.helpmanual.io>pydantic</a></td><td>1.7.3</td><td>5.0k</td><td>今回の比較対象の中では最も新しい。<br>FastAPIに組み込まれている。</td></tr><tr><td style=text-align:left><a href=https://marshmallow.readthedocs.io/en/stable/>marshmallow</a></td><td>3.10.0</td><td>5.2k</td><td>最も人気。FlaskやSQLAlchemyといった人気ライブラリ<br>とのインテグレーションもある。</td></tr><tr><td style=text-align:left><a href=https://www.attrs.org/en/stable/>attrs</a><br>(+ <a href=https://github.com/Tinche/cattrs>cattrs</a>)</td><td>20.3.0, (1.1.2)</td><td>3.3k</td><td>Pythonクラスを簡単に定義するために開発されたもの。<br>標準のdataclassで<a href=https://www.python.org/dev/peps/pep-0557/#why-not-just-use-attrs>&ldquo;Why not just use attrs ?"</a>と注釈されている。<br>cattrsは、attrsにシリアライズ・デシリアライズを可能にするライブラリ。<br>今回は併用する前提で比較。</td></tr><tr><td style=text-align:left><a href=http://docs.python-cerberus.org>cerberus</a></td><td>1.3.2</td><td>2.3k</td><td><a href=https://docs.python-eve.org/en/stable/>eve</a>というFlaskベースのフレームワークで採用されている。<br>eve自体を利用している例は見たことがないが、<br>cerberus単体では利用されている印象。</td></tr></tbody></table><h3 id=比較対象の選定の基準>比較対象の選定の基準</h3><ul><li>スキーマ定義が可能なこと</li><li>バリデーション定義が可能なこと</li><li>ある程度アクティブなプロジェクトであること</li><li>HTTPリクエストのパースなど、特定の用途のみではなく、幅広い用途に利用できること。</li></ul><h3 id=候補から除外したライブラリ>候補から除外したライブラリ</h3><ul><li><a href=https://schematics.readthedocs.io/en/latest/>schematics</a><ul><li>Github Star数は2.4kとまぁまぁ多いですが、2018年12月を最後にコミットが途絶えており、PRも放置されている状態。特殊な機能もなく選定される理由はないので除外。</li></ul></li><li><a href=https://docs.pylonsproject.org/projects/colander/en/latest/>colander</a></li><li><a href=https://www.django-rest-framework.org/>django-rest-framework</a></li><li><a href=https://flask-restful.readthedocs.io/en/latest/index.html>flask-restful</a><ul><li>この3つはいずれもスキーマバリデーションが可能ですが、HTTPリクエストパースのために特定のフレームワークと共に利用されることを前提しているので除外</li></ul></li><li><a href=https://python-jsonschema.readthedocs.io/en/v3.2.0/>jsonschema</a><ul><li>デフォルト値の適用などの変換処理がないため除外</li></ul></li></ul><h1 id=機能の比較>機能の比較</h1><h2 id=スキーマ定義に関する機能>スキーマ定義に関する機能</h2><table><thead><tr><th></th><th>pydantic</th><th>marshmallow</th><th>attrs</th><th>cerberus</th></tr></thead><tbody><tr><td>スキーマ定義の方法</td><td>class</td><td>class</td><td>class</td><td>dict</td></tr><tr><td>required指定</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>nullable可否の指定</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>defaultの指定</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>default factoryの指定</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>カスタム型</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>定義のネスト</td><td>Yes</td><td>Yes</td><td><span style=color:red>No</span></td><td>Yes</td></tr><tr><td>定義の再利用 (継承など)</td><td>Yes</td><td>Yes</td><td><span style=color:red>No</span></td><td>Yes</td></tr><tr><td>定義の動的生成</td><td>Yes</td><td><span style=color:red>No</span></td><td><span style=color:red>No</span></td><td>Yes</td></tr><tr><td>型アノテーション</td><td>Yes</td><td><span style=color:red>No</span></td><td>Yes</td><td><span style=color:red>No</span></td></tr></tbody></table><h3 id=コメント>コメント</h3><ul><li>pydanticは高機能</li><li>cerberusは唯一、dictでスキーマ定義をする</li><li>attrsは複雑な用途には不向き</li><li>marshmallowも高機能だが、スキーマクラスをデータオブジェクトとして利用できない点がpydantic / attrsとの差。適切なデータオブジェクトへの変換はユーザーが責任を持つ。<ul><li><a href=https://marshmallow.readthedocs.io/en/stable/quickstart.html#deserializing-objects-loading>https://marshmallow.readthedocs.io/en/stable/quickstart.html#deserializing-objects-loading</a></li></ul></li></ul><h2 id=バリデーション定義に関する機能>バリデーション定義に関する機能</h2><table><thead><tr><th></th><th>pydantic</th><th>marshmallow</th><th>attrs</th><th>cerberus</th></tr></thead><tbody><tr><td>型バリデーション</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Union型バリデーション</td><td>Yes</td><td><span style=color:red>No *</span></td><td><span style=color:red>No</span></td><td>Yes</td></tr><tr><td>範囲バリデーション（ge / le / gt / lt）</td><td>Yes</td><td>Yes</td><td><span style=color:red>No</span></td><td>Yes</td></tr><tr><td>lengthバリデーション</td><td>Yes</td><td>Yes</td><td><span style=color:red>No</span></td><td>Yes</td></tr><tr><td>正規表現バリデーション</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>oneOfバリデーション</td><td>Yes</td><td>Yes</td><td><span style=color:red>No</span></td><td>Yes</td></tr><tr><td>カスタムバリデーション</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>複数フィールドにまたがるバリデーション</td><td>Yes</td><td>Yes</td><td><span style=color:red>No</span></td><td><span style=color:red>No</span></td></tr><tr><td>未定義のフィールドの扱い（無視・エラー選択）</td><td>Yes</td><td>Yes</td><td><span style=color:red>No</span></td><td>Yes</td></tr></tbody></table><h3 id=コメント-1>コメント</h3><ul><li>marshmallowは<a href=https://github.com/adamboche/python-marshmallow-union>プラグイン</a>を別途インストールすることでUnionにも対応できるようです</li><li>attrsはバリデータの機能が弱いようです。</li></ul><h2 id=シリアライズデシリアライズに関する機能>シリアライズ・デシリアライズに関する機能</h2><table><thead><tr><th></th><th>pydantic</th><th>marshmallow</th><th>attrs</th><th>cerberus</th></tr></thead><tbody><tr><td>model -> dict</td><td>Yes</td><td>Yes</td><td>Yes</td><td><span style=color:red>No</span></td></tr><tr><td>dict -> model</td><td>Yes</td><td>Yes</td><td>Yes</td><td><span style=color:red>No</span></td></tr><tr><td>※model -> json文字列</td><td>Yes</td><td><span style=color:red>No</span></td><td><span style=color:red>No</span></td><td><span style=color:red>No</span></td></tr><tr><td>json文字列 -> ※model</td><td>Yes</td><td><span style=color:red>No</span></td><td><span style=color:red>No</span></td><td><span style=color:red>No</span></td></tr><tr><td>フィールド名のエイリアス</td><td>Yes</td><td><span style=color:red>No</span></td><td><span style=color:red>No</span></td><td><span style=color:red>No</span></td></tr><tr><td>フィールド除外（シリアライズ）</td><td>Yes</td><td>Yes</td><td><span style=color:red>No ?</span></td><td><span style=color:red>No</span></td></tr><tr><td>カスタムシリアライザ</td><td>Yes</td><td>Yes</td><td>Yes</td><td><span style=color:red>No</span></td></tr><tr><td>環境変数読み込み（デシリアライズ）</td><td>Yes</td><td><span style=color:red>No</span></td><td><span style=color:red>No</span></td><td><span style=color:red>No</span></td></tr></tbody></table><p>※ model &lt;-> json文字列変換には、datetime, enum, ネストしたモデル型を持つモデルを対象とします。datetimeやEnumといった型を、特にカスタムコードを追加することなく文字列化可能かを検査しています。</p><h3 id=コメント-2>コメント</h3><ul><li>marshmallowについて<ul><li>Enum型への対応は <a href=https://pypi.org/project/marshmallow-enum/>プラグイン</a>を使えば可能です。</li><li>datetime型をdictからモデルに変換する場合、文字列に直さないと変換できません。</li><li><a href=https://marshmallow.readthedocs.io/en/stable/quickstart.html#deserializing-to-objects>モデルデータを保持するクラスは、ライブラリを使ったスキーマとは別に自分で用意しなければいけない</a>ため、型定義が二重になる。</li></ul></li><li>attrsについて<ul><li><code>cattr</code> を使えば <code>datetime</code> にも対応できますが、追加のコードが必要です。</li><li>使い慣れていないので、実はYesの項目もあるかもです。</li></ul></li><li>cerberusについて<ul><li>そもそもモデルクラスのインスタンスに変換することをサポートしていません。</li></ul></li><li>pydantic<ul><li>環境変数が読み込めるのがユニークです。これにより、<a href=https://pydantic-docs.helpmanual.io/usage/settings/>設定管理にも利用</a>できます。<a href=https://pypi.org/project/python-dotenv/>dotenv</a>も利用できます。</li></ul></li></ul><h2 id=総合的な使い心地について>総合的な使い心地について</h2><p>個人的な視点も入ってしまいますが、使い心地についても評価してみようと思います。</p><table><thead><tr><th></th><th>pydantic</th><th>marshmallow</th><th>attrs</th><th>cerberus</th></tr></thead><tbody><tr><td>全体的な機能の充実度</td><td>とても良い</td><td>とても良い</td><td>イマイチ</td><td>普通</td></tr><tr><td>スキーマの定義しやすさ</td><td>とても良い</td><td>良い</td><td>良い</td><td>イマイチ</td></tr><tr><td>コード補完の効きやすさ</td><td>とても良い</td><td>良い</td><td>良い</td><td>イマイチ</td></tr><tr><td>バリデーションの充実度</td><td>とても良い</td><td>とても良い</td><td>イマイチ</td><td>良い</td></tr><tr><td>パフォーマンス ※</td><td>良い？</td><td>普通？</td><td>とても良い？</td><td>イマイチ？</td></tr></tbody></table><h3 id=コメント-3>コメント</h3><ul><li>フィールドに自然に型アノテーションをつけられるPydanticはやはり書きやすいです。<a href=https://pydantic-docs.helpmanual.io/pycharm_plugin/>Pycharmプラグイン</a>も開発されているのも良いです。</li><li>パフォーマンスについて<ul><li><a href=https://pydantic-docs.helpmanual.io/benchmarks/>Pydanticのパフォーマンス比較</a>と、<a href=https://stefan.sofa-rockers.org/2020/05/29/attrs-dataclasses-pydantic/>こちらのブログ</a>から。参考程度の比較になります。</li></ul></li></ul><h1 id=まとめ>まとめ</h1><p>Pydanticびいきの比較になってしまったような気もしますが、概ね以下の通りです。</p><ul><li>pydantic<ul><li>機能の充実度と書きやすさが両立されており、まず最初に候補に入れるべきライブラリ。</li><li>Python3.6以上にしか対応していないので、古いシステムには使えない。</li></ul></li><li>marshmallow<ul><li>Pydanticと同等に近い充実度。pydanticよりも歴史があるので、事例も多い。</li><li>スキーマからモデルクラスを作る場合、自分で用意しなきゃいけないのが面倒。</li><li>別途インストールするプラグインも多くあるので、機能として足りない部分を補うことも期待できる。</li><li>Flaskを使うのなら、Pydanticよりもこちらのほうが事例が多そう。<a href=https://flask-marshmallow.readthedocs.io/en/latest/>flask-marshmallow</a>というライブラリもある。</li></ul></li><li>attrs<ul><li>そもそもがバリデーションライブラリではなく、dataclassのようにクラスを書きやすくするライブラリなので、バリデーションについては弱め。</li><li>機能の充実度は低いですが、パフォーマンスは良いので要件の厳しい部分では使えそう。</li></ul></li><li>cerberus<ul><li>今回の中では唯一、dictでスキーマを定義するタイプ。</li><li>jsonschemaっぽい独自構文で定義するのだが、コード補完も効かないので定義するのが大変。</li><li>あまりこれを使うシーンは思い浮かばないのが正直なところ。</li></ul></li></ul></div><div class=post-tags><nav class="nav tags"><ul class=flat><li><a href=/tags/python>python</a></li><li><a href=/tags/tech>tech</a></li></ul></nav></div></div><div class="footer wrapper"><section class="section sns"><nav class="nav social"><ul class=flat><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fattsun1031.github.io%2fposts%2fpython-validation-framework-comparison%2f&text=Python%e3%82%b9%e3%82%ad%e3%83%bc%e3%83%9e%e3%83%90%e3%83%aa%e3%83%87%e3%83%bc%e3%82%b7%e3%83%a7%e3%83%b3%e3%83%a9%e3%82%a4%e3%83%96%e3%83%a9%e3%83%aa%e6%af%94%e8%bc%83%20%28pydantic%2c%20marshmallow%2c%20attrs%2c%20cerberus%29" target=_blank title=Tweet><i data-feather=twitter></i></a><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fattsun1031.github.io%2fposts%2fpython-validation-framework-comparison%2f" target=_blank title=facebook><i data-feather=facebook></i></a></ul></nav></section><nav class=nav><div><a href=https://github.com/vividvilla/ezhil>Ezhil theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></nav></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-187497329-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script>feather.replace()</script></body></html>
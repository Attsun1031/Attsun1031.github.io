<!DOCTYPE html><html lang="ja"><head><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" content="#000000"/><link rel="alternate" type="application/rss+xml" href="/index.xml"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap" media="print"/><noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap"/></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-187497329-1"></script><script>
                  window.dataLayer = window.dataLayer || [];
                  function gtag(){dataLayer.push(arguments);}
                  gtag('js', new Date());
                  gtag('config', 'UA-187497329-1', {
                    page_path: window.location.pathname,
                  });
                </script><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if(!e)return localStorage.setItem('theme','light'),d.add('light');if("system"===e){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/__Attsun__"/><meta name="twitter:creator" content="https://twitter.com/__Attsun__"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="600"/><meta property="og:locale" content="ja"/><meta name="author" content="Tatsuya Atsumi"/><title>GCPで、適当に実行すべきでない3つのコト – Attsun Blog</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="GCPで、実行前に立ち止まって考えたい3つの事についてまとめました。"/><meta property="og:url" content="https://attsun1031.github.io//blog/gcp-three-things"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2021-07-07T00:00:00.000Z"/><meta property="article:modified_time" content="2021-07-07T00:00:00.000Z"/><meta property="article:author" content="https://attsun1031.github.io//about"/><meta property="article:tag" content="tech"/><meta property="article:tag" content="gcp"/><meta property="og:title" content="GCPで、適当に実行すべきでない3つのコト"/><meta property="og:description" content="GCPで、実行前に立ち止まって考えたい3つの事についてまとめました。"/><meta property="og:image" content="https://attsun1031.github.io//static/images/twitter-card.png"/><meta property="og:image:alt" content="GCPで、適当に実行すべきでない3つのコト"/><link rel="canonical" href="https://attsun1031.github.io//blog/gcp-three-things"/><meta name="twitter:image" content="https://attsun1031.github.io//static/images/twitter-card.png"/><script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "Article",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://attsun1031.github.io//blog/gcp-three-things"
    },
    "headline": "GCPで、適当に実行すべきでない3つのコト",
    "image": [
      "[object Object]"
     ],
    "datePublished": "2021-07-07T00:00:00.000Z",
    "dateModified": "2021-07-07T00:00:00.000Z",
    "author": {"@type": "Person","name": "Tatsuya Atsumi"},
    "publisher": {
      "@type": "Organization",
      "name": "Tatsuya Atsumi",
      "logo": {
        "@type": "ImageObject",
        "url": "undefined"
      }
    },
    "description": "GCPで、実行前に立ち止まって考えたい3つの事についてまとめました。"
  }</script><meta name="next-head-count" content="28"/><link rel="preload" href="/_next/static/css/3e51e17a356c17193536.css" as="style"/><link rel="stylesheet" href="/_next/static/css/3e51e17a356c17193536.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-a837451738e9bc430433.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.3001023d071dd3bbe4b7.js" as="script"/><link rel="preload" href="/_next/static/chunks/26ad184ddc2343b861b9bcedad5ceb01b11d41f7.9fbf4a83f1e2236cbcd2.js" as="script"/><link rel="preload" href="/_next/static/chunks/a438ddfc9656e71378afc75153a3af52615c85dc.b8ba261f8bcc605c9ae9.js" as="script"/><link rel="preload" href="/_next/static/chunks/c9787b2e67d04485ea556b79e503c7f6cc1ff4d5.2f5b2218d060fcd58c6c.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-b754ef2746e4a2a0470e.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/%5Bslug%5D-52f3b409457246020eb7.js" as="script"/></head><body class="antialiased text-black bg-white dark:bg-gray-900 dark:text-white"><div id="__next"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-12"><div class="flex flex-col justify-between h-screen"><header class="flex items-center justify-between py-10"><div><a aria-label="Tailwind CSS Blog" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="50" height="50"><image width="50" height="50" href="data:image/png;base64,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"></image></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Attsun Blog</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="w-8 h-8 p-1 ml-1 mr-1 rounded sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="w-8 h-8 ml-1 mr-1 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed w-full h-full top-24 right-0 bg-gray-200 dark:bg-gray-800 opacity-95 z-10 transform ease-in-out duration-300 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed w-full h-full cursor-auto focus:outline-none"></button><nav class="fixed h-full mt-8"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-12"><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1"><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">GCPで、適当に実行すべきでない3つのコト</h1></div></div></header><div class="pb-8 divide-y divide-gray-200 xl:divide-y-0 dark:divide-gray-700 xl:grid xl:grid-cols-3 xl:gap-x-6" style="grid-template-rows:auto 1fr"><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:pb-0 xl:col-span-3 xl:row-span-2"><dl class="pt-6 pb-10 xl:pt-11 xl:border-b xl:border-gray-200 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 xl:block sm:space-x-12 xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img src="/static/images/avatar.png" alt="avatar" class="w-10 h-10 rounded-full"/><dl class="text-sm font-medium leading-5 whitespace-nowrap"><dt class="sr-only">Twitter</dt><dd><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/__Attsun__" class="text-blue-500 hover:text-blue-600 dark:hover:text-blue-400">@__Attsun__</a></dd><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2021-07-07">Wednesday, July 7, 2021</time></dd></dl></li></ul></dd></dl><div class="pt-10 pb-8 prose dark:prose-dark max-w-none"><div><h1 id="about"><a href="#about" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>About</h1><p>GCP で、実行前に気をつけたい 3 つの機能を紹介します。</p><p>元ネタは、同僚の <a href="https://twitter.com/sakajunquality">@sakajunquality</a> が社内用に作ったドキュメントです。
内容がとても良かったので、本人に許可を取った上で加筆修正し、公開しています。</p><h1 id="tldr"><a href="#tldr" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>TL;DR</h1><p>GCP では、以下 3 つの作業に注意しましょう</p><ol><li>Service Account のクレデンシャルダウンロード。対策として、そもそもダウンロードしなければいけない機会を減らしましょう。また、権限を適切に絞りましょう</li><li>Compute Engine Default Service Accont の利用。対策として、専用の Service Account を用意しましょう</li><li>App Engine の有効化。有効化する際はリージョンに気をつけましょう。なんとなく有効化するのはやめましょう</li></ol><h1 id="1-service-account-key-のダウンロード"><a href="#1-service-account-key-%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>(1) Service Account Key のダウンロード</h1><p>GCP では以下のように ServiceAccount (以下、SA) の Key をダウンロードし、その SA を使うことができます。</p><p><a href="https://cloud.google.com/iam/docs/creating-managing-service-account-keys#creating_service_account_keys">公式 Doc</a></p><h2 id="何が問題か？"><a href="#%E4%BD%95%E3%81%8C%E5%95%8F%E9%A1%8C%E3%81%8B%EF%BC%9F" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>何が問題か？</h2><p>特にローカル端末へのダウンロードは、権限の管理が難しくする要因となります。
結果として、例えば以下のようなリスクが出てきます。</p><ul><li>ローカルから外部への流出（例：自分の Public Repostiory に上げちゃいました）</li><li>ダウンロードしたメンバーが退職した際のローテート</li></ul><p>SA に <code>Project Editor</code> や <code>Project Owner</code> のような非常に強い権限が付与されている場合、リスクは大きくなります。</p><h2 id="どうすればよいか？"><a href="#%E3%81%A9%E3%81%86%E3%81%99%E3%82%8C%E3%81%B0%E3%82%88%E3%81%84%E3%81%8B%EF%BC%9F" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>どうすればよいか？</h2><h3 id="権限を絞る"><a href="#%E6%A8%A9%E9%99%90%E3%82%92%E7%B5%9E%E3%82%8B" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>権限を絞る</h3><p>各 SA に、用途に応じた最小限の権限を設定しましょう。面倒くさがって <code>Project Editor</code> や <code>Project Owner</code> をとりあえずつけてしまうのは NG です。</p><p>また、Terraform を利用することで、権限が必要な文脈やこれまでの経緯などが残ったり、PR ベースの権限付与が可能となるのででオススメです。</p><p><a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam">google_project_iam</a></p><h3 id="キーのダウンロードを不要にする"><a href="#%E3%82%AD%E3%83%BC%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%82%92%E4%B8%8D%E8%A6%81%E3%81%AB%E3%81%99%E3%82%8B" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>キーのダウンロードを不要にする</h3><p>そもそもキーが必要とならないようにすることも有効です。</p><h4 id="workfload-identity"><a href="#workfload-identity" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Workfload Identity</h4><p>GKE 内で GCP の SA を利用したい場合、 <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/workload-identity">Workflow Identity</a> の仕組みを利用することで、キーのダウンロードをせずに SA を利用することが可能となります。具体的には、GCP の SA を Kubernetes の SA に紐づけています。</p><p>AWS など GCP 外から SA を利用する場合でも、 <a href="https://cloud.google.com/iam/docs/workload-identity-federation">Workload identity federation</a> の利用が可能です。</p><h4 id="service-account-impersonation"><a href="#service-account-impersonation" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Service Account Impersonation</h4><p>ローカルなど、Workload Identity を利用できない場合でも、<a href="https://cloud.google.com/iam/docs/impersonating-service-accounts">Service Account Impersonation</a> によりキーのダウンロードを回避できます。</p><p>例えば gcloud コマンドであれば、上記のリンクの権限を付与した後、 <code>gloud --impersonate-service-account {SA の email} ...</code> とすることで、その SA の権限においてコマンドを実行できます。</p><h2 id="ダウンロードを回避できない場合"><a href="#%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%82%92%E5%9B%9E%E9%81%BF%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>ダウンロードを回避できない場合</h2><p>例えば SaaS から GCP リソースを操作させる場合、キーのダウンロードが必須になってしまうケースは存在します。</p><p>こういった場合でも、<code>roles/iam.serviceAccountKeyAdmin</code> を付与するユーザーを限定するなどにより、無闇なダウンロードを防ぎましょう。</p><h1 id="2-compute-engine-default-service-account-を利用"><a href="#2-compute-engine-default-service-account-%E3%82%92%E5%88%A9%E7%94%A8" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>(2) Compute Engine Default Service Account を利用</h1><p>Compute Engine の API を有効化すると、 <code>PROJECT_NUMBER-compute@developer.gserviceaccount.com</code> のような SA が自動で作成されます。</p><p>この SA は Cloud Composer や Dataflow といった、Compute Engine をサービスの一部として利用するサービスにおいても利用されます。</p><h2 id="何が問題か？-1"><a href="#%E4%BD%95%E3%81%8C%E5%95%8F%E9%A1%8C%E3%81%8B%EF%BC%9F-1" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>何が問題か？</h2><p>この SA は <code>roles/editor</code> という強い権限をプロジェクトレベルで持っています。</p><p>特定の用途にのみ利用する場合には問題ありません。しかし、複数のアプリやサービスの配置など用途が異なるもの混在させる場合、この SA を利用した Compute Instance からはほぼあらゆるリソースにアクセスできてしまうため、ガバナンス観点でも望ましくありませんし、思わぬ事故につながるリスクもあります。</p><h2 id="どうすればよいか？-1"><a href="#%E3%81%A9%E3%81%86%E3%81%99%E3%82%8C%E3%81%B0%E3%82%88%E3%81%84%E3%81%8B%EF%BC%9F-1" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>どうすればよいか？</h2><p>(1) の内容に繋がりますが、ワークロードごとに権限を絞った SA を作り、起動時に適切な SA を利用するようにしましょう。</p><h3 id="gke-の場合"><a href="#gke-%E3%81%AE%E5%A0%B4%E5%90%88" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>GKE の場合</h3><p><a href="https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#use_least_privilege_sa">こちらの公式ドキュメント</a>に、GKE Standard Cluster を構築する場合に必要なミニマムの権限が紹介されていますので、このガイドをベースに SA を作成しましょう。</p><h3 id="dataflow-dataproc-datafusion-の場合"><a href="#dataflow-dataproc-datafusion-%E3%81%AE%E5%A0%B4%E5%90%88" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Dataflow, DataProc, DataFusion の場合</h3><p>Dataflow, DataProc, DataFusion については、Compute Engine Default SA を impersonate する権限がないにも関わらず、その権限において起動できてしまうというレガシーな挙動が残っています。</p><p><a href="https://cloud.google.com/iam/docs/service-accounts-actas#dataproc-dataflow-datafusion">こちらのドキュメント</a>を参考に、このようなな挙動をオフにすることで、安易に Compute Engine Default SA の利用を防ぐことが可能です。</p><h1 id="3-適当に-app-engine-を有効化--deploy"><a href="#3-%E9%81%A9%E5%BD%93%E3%81%AB-app-engine-%E3%82%92%E6%9C%89%E5%8A%B9%E5%8C%96--deploy" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>(3) 適当に App Engine を有効化 / Deploy</h1><h2 id="何が問題か？-2"><a href="#%E4%BD%95%E3%81%8C%E5%95%8F%E9%A1%8C%E3%81%8B%EF%BC%9F-2" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>何が問題か？</h2><h3 id="app-engine-のリージョンが他のサービスにも不可逆な影響を及ぼす"><a href="#app-engine-%E3%81%AE%E3%83%AA%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%81%8C%E4%BB%96%E3%81%AE%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AB%E3%82%82%E4%B8%8D%E5%8F%AF%E9%80%86%E3%81%AA%E5%BD%B1%E9%9F%BF%E3%82%92%E5%8F%8A%E3%81%BC%E3%81%99" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>App Engine のリージョンが他のサービスにも不可逆な影響を及ぼす</h3><p>App Engine を有効化する際にはリージョンを選びますが、一度選ぶと変更できません。
そして、Cloud Tasks, Cloud Scheduler などもこのリージョンに依存します。</p><h3 id="デフォルトで強力な権限を持った-sa-が利用される"><a href="#%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%81%A7%E5%BC%B7%E5%8A%9B%E3%81%AA%E6%A8%A9%E9%99%90%E3%82%92%E6%8C%81%E3%81%A3%E3%81%9F-sa-%E3%81%8C%E5%88%A9%E7%94%A8%E3%81%95%E3%82%8C%E3%82%8B" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>デフォルトで強力な権限を持った SA が利用される</h3><p>(2) の Compute Engine Default SA と同じく、 <code>roles/editor</code> をプロジェクトレベルで持った強力な SA が利用されます。</p><p>厄介なのは、例えば Cloud Run のように任意の SA を指定してデプロイすることができません。</p><p>なので、SA を変更するのではなく、デフォルト SA の権限を調整するという方法が<a href="https://cloud.google.com/appengine/docs/standard/python3/service-account">こちらのドキュメント</a>で紹介されています。</p><h3 id="どうすればよいか？-2"><a href="#%E3%81%A9%E3%81%86%E3%81%99%E3%82%8C%E3%81%B0%E3%82%88%E3%81%84%E3%81%8B%EF%BC%9F-2" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>どうすればよいか？</h3><p>App Engine を使いたいのであれば、リージョンは慎重に選択しましょう。使ってみたいだけであれば、サンドボックス用のプロジェクトなど、潰しても良いプロジェクトを選びましょう。</p><p>また、現在であれば Cloud Run も、App Engine 並の手軽さと低コストでアプリケーションの運用ができるのでオススメです。</p><hr/><p>以上、GCP で実行前に気をつけたい 3 つのことの紹介でした。</p></div></div><div class="text-sm font-medium leading-5 divide-gray-200 xl:divide-y dark:divide-gray-700 xl:col-start-1 xl:row-start-2"><div class="py-4 xl:py-8"><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium text-blue-500 uppercase hover:text-blue-600 dark:hover:text-blue-400" href="/tags/tech">tech</a><a class="mr-3 text-sm font-medium text-blue-500 uppercase hover:text-blue-600 dark:hover:text-blue-400" href="/tags/gcp">gcp</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Previous Article</h2><div class="text-blue-500 hover:text-blue-600 dark:hover:text-blue-400"><a href="/blog/what-is-datamesh">Data Meshとは何か？</a></div></div><div><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Next Article</h2><div class="text-blue-500 hover:text-blue-600 dark:hover:text-blue-400"><a href="/blog/pydantic-intro">FastAPIを使っていなくても、Pydanticは便利です</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-blue-500 hover:text-blue-600 dark:hover:text-blue-400" href="/blog">← Back to the blog</a></div></div></div></div></article></div></main><footer><div class="flex flex-col items-center mt-16"><div class="flex mb-3 space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/Attsun1031"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://twitter.com/__Attsun__"><span class="sr-only">twitter</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></a></div><div class="flex mb-2 space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Tatsuya Atsumi</div><div> • </div><div>© 2021</div><div> • </div><a href="/">Attsun Blog</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":{"compiledSource":"\"use strict\";\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i \u003c arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i \u003c sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) \u003e= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i \u003c sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) \u003e= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar layoutProps = {};\nvar MDXLayout = \"wrapper\";\n\nfunction MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", {\n    \"id\": \"about\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h1\"\n  }, {\n    \"href\": \"#about\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), \"About\"), mdx(\"p\", null, \"GCP \\u3067\\u3001\\u5B9F\\u884C\\u524D\\u306B\\u6C17\\u3092\\u3064\\u3051\\u305F\\u3044 3 \\u3064\\u306E\\u6A5F\\u80FD\\u3092\\u7D39\\u4ECB\\u3057\\u307E\\u3059\\u3002\"), mdx(\"p\", null, \"\\u5143\\u30CD\\u30BF\\u306F\\u3001\\u540C\\u50DA\\u306E \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://twitter.com/sakajunquality\"\n  }), \"@sakajunquality\"), \" \\u304C\\u793E\\u5185\\u7528\\u306B\\u4F5C\\u3063\\u305F\\u30C9\\u30AD\\u30E5\\u30E1\\u30F3\\u30C8\\u3067\\u3059\\u3002\\n\\u5185\\u5BB9\\u304C\\u3068\\u3066\\u3082\\u826F\\u304B\\u3063\\u305F\\u306E\\u3067\\u3001\\u672C\\u4EBA\\u306B\\u8A31\\u53EF\\u3092\\u53D6\\u3063\\u305F\\u4E0A\\u3067\\u52A0\\u7B46\\u4FEE\\u6B63\\u3057\\u3001\\u516C\\u958B\\u3057\\u3066\\u3044\\u307E\\u3059\\u3002\"), mdx(\"h1\", {\n    \"id\": \"tldr\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h1\"\n  }, {\n    \"href\": \"#tldr\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), \"TL;DR\"), mdx(\"p\", null, \"GCP \\u3067\\u306F\\u3001\\u4EE5\\u4E0B 3 \\u3064\\u306E\\u4F5C\\u696D\\u306B\\u6CE8\\u610F\\u3057\\u307E\\u3057\\u3087\\u3046\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Service Account \\u306E\\u30AF\\u30EC\\u30C7\\u30F3\\u30B7\\u30E3\\u30EB\\u30C0\\u30A6\\u30F3\\u30ED\\u30FC\\u30C9\\u3002\\u5BFE\\u7B56\\u3068\\u3057\\u3066\\u3001\\u305D\\u3082\\u305D\\u3082\\u30C0\\u30A6\\u30F3\\u30ED\\u30FC\\u30C9\\u3057\\u306A\\u3051\\u308C\\u3070\\u3044\\u3051\\u306A\\u3044\\u6A5F\\u4F1A\\u3092\\u6E1B\\u3089\\u3057\\u307E\\u3057\\u3087\\u3046\\u3002\\u307E\\u305F\\u3001\\u6A29\\u9650\\u3092\\u9069\\u5207\\u306B\\u7D5E\\u308A\\u307E\\u3057\\u3087\\u3046\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Compute Engine Default Service Accont \\u306E\\u5229\\u7528\\u3002\\u5BFE\\u7B56\\u3068\\u3057\\u3066\\u3001\\u5C02\\u7528\\u306E Service Account \\u3092\\u7528\\u610F\\u3057\\u307E\\u3057\\u3087\\u3046\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"App Engine \\u306E\\u6709\\u52B9\\u5316\\u3002\\u6709\\u52B9\\u5316\\u3059\\u308B\\u969B\\u306F\\u30EA\\u30FC\\u30B8\\u30E7\\u30F3\\u306B\\u6C17\\u3092\\u3064\\u3051\\u307E\\u3057\\u3087\\u3046\\u3002\\u306A\\u3093\\u3068\\u306A\\u304F\\u6709\\u52B9\\u5316\\u3059\\u308B\\u306E\\u306F\\u3084\\u3081\\u307E\\u3057\\u3087\\u3046\")), mdx(\"h1\", {\n    \"id\": \"1-service-account-key-のダウンロード\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h1\"\n  }, {\n    \"href\": \"#1-service-account-key-%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), \"(1) Service Account Key \\u306E\\u30C0\\u30A6\\u30F3\\u30ED\\u30FC\\u30C9\"), mdx(\"p\", null, \"GCP \\u3067\\u306F\\u4EE5\\u4E0B\\u306E\\u3088\\u3046\\u306B ServiceAccount (\\u4EE5\\u4E0B\\u3001SA) \\u306E Key \\u3092\\u30C0\\u30A6\\u30F3\\u30ED\\u30FC\\u30C9\\u3057\\u3001\\u305D\\u306E SA \\u3092\\u4F7F\\u3046\\u3053\\u3068\\u304C\\u3067\\u304D\\u307E\\u3059\\u3002\"), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://cloud.google.com/iam/docs/creating-managing-service-account-keys#creating_service_account_keys\"\n  }), \"\\u516C\\u5F0F Doc\")), mdx(\"h2\", {\n    \"id\": \"何が問題か？\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#%E4%BD%95%E3%81%8C%E5%95%8F%E9%A1%8C%E3%81%8B%EF%BC%9F\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), \"\\u4F55\\u304C\\u554F\\u984C\\u304B\\uFF1F\"), mdx(\"p\", null, \"\\u7279\\u306B\\u30ED\\u30FC\\u30AB\\u30EB\\u7AEF\\u672B\\u3078\\u306E\\u30C0\\u30A6\\u30F3\\u30ED\\u30FC\\u30C9\\u306F\\u3001\\u6A29\\u9650\\u306E\\u7BA1\\u7406\\u304C\\u96E3\\u3057\\u304F\\u3059\\u308B\\u8981\\u56E0\\u3068\\u306A\\u308A\\u307E\\u3059\\u3002\\n\\u7D50\\u679C\\u3068\\u3057\\u3066\\u3001\\u4F8B\\u3048\\u3070\\u4EE5\\u4E0B\\u306E\\u3088\\u3046\\u306A\\u30EA\\u30B9\\u30AF\\u304C\\u51FA\\u3066\\u304D\\u307E\\u3059\\u3002\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"\\u30ED\\u30FC\\u30AB\\u30EB\\u304B\\u3089\\u5916\\u90E8\\u3078\\u306E\\u6D41\\u51FA\\uFF08\\u4F8B\\uFF1A\\u81EA\\u5206\\u306E Public Repostiory \\u306B\\u4E0A\\u3052\\u3061\\u3083\\u3044\\u307E\\u3057\\u305F\\uFF09\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"\\u30C0\\u30A6\\u30F3\\u30ED\\u30FC\\u30C9\\u3057\\u305F\\u30E1\\u30F3\\u30D0\\u30FC\\u304C\\u9000\\u8077\\u3057\\u305F\\u969B\\u306E\\u30ED\\u30FC\\u30C6\\u30FC\\u30C8\")), mdx(\"p\", null, \"SA \\u306B \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Project Editor\"), \" \\u3084 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Project Owner\"), \" \\u306E\\u3088\\u3046\\u306A\\u975E\\u5E38\\u306B\\u5F37\\u3044\\u6A29\\u9650\\u304C\\u4ED8\\u4E0E\\u3055\\u308C\\u3066\\u3044\\u308B\\u5834\\u5408\\u3001\\u30EA\\u30B9\\u30AF\\u306F\\u5927\\u304D\\u304F\\u306A\\u308A\\u307E\\u3059\\u3002\"), mdx(\"h2\", {\n    \"id\": \"どうすればよいか？\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#%E3%81%A9%E3%81%86%E3%81%99%E3%82%8C%E3%81%B0%E3%82%88%E3%81%84%E3%81%8B%EF%BC%9F\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), \"\\u3069\\u3046\\u3059\\u308C\\u3070\\u3088\\u3044\\u304B\\uFF1F\"), mdx(\"h3\", {\n    \"id\": \"権限を絞る\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#%E6%A8%A9%E9%99%90%E3%82%92%E7%B5%9E%E3%82%8B\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), \"\\u6A29\\u9650\\u3092\\u7D5E\\u308B\"), mdx(\"p\", null, \"\\u5404 SA \\u306B\\u3001\\u7528\\u9014\\u306B\\u5FDC\\u3058\\u305F\\u6700\\u5C0F\\u9650\\u306E\\u6A29\\u9650\\u3092\\u8A2D\\u5B9A\\u3057\\u307E\\u3057\\u3087\\u3046\\u3002\\u9762\\u5012\\u304F\\u3055\\u304C\\u3063\\u3066 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Project Editor\"), \" \\u3084 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Project Owner\"), \" \\u3092\\u3068\\u308A\\u3042\\u3048\\u305A\\u3064\\u3051\\u3066\\u3057\\u307E\\u3046\\u306E\\u306F NG \\u3067\\u3059\\u3002\"), mdx(\"p\", null, \"\\u307E\\u305F\\u3001Terraform \\u3092\\u5229\\u7528\\u3059\\u308B\\u3053\\u3068\\u3067\\u3001\\u6A29\\u9650\\u304C\\u5FC5\\u8981\\u306A\\u6587\\u8108\\u3084\\u3053\\u308C\\u307E\\u3067\\u306E\\u7D4C\\u7DEF\\u306A\\u3069\\u304C\\u6B8B\\u3063\\u305F\\u308A\\u3001PR \\u30D9\\u30FC\\u30B9\\u306E\\u6A29\\u9650\\u4ED8\\u4E0E\\u304C\\u53EF\\u80FD\\u3068\\u306A\\u308B\\u306E\\u3067\\u3067\\u30AA\\u30B9\\u30B9\\u30E1\\u3067\\u3059\\u3002\"), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam\"\n  }), \"google_project_iam\")), mdx(\"h3\", {\n    \"id\": \"キーのダウンロードを不要にする\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#%E3%82%AD%E3%83%BC%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%82%92%E4%B8%8D%E8%A6%81%E3%81%AB%E3%81%99%E3%82%8B\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), \"\\u30AD\\u30FC\\u306E\\u30C0\\u30A6\\u30F3\\u30ED\\u30FC\\u30C9\\u3092\\u4E0D\\u8981\\u306B\\u3059\\u308B\"), mdx(\"p\", null, \"\\u305D\\u3082\\u305D\\u3082\\u30AD\\u30FC\\u304C\\u5FC5\\u8981\\u3068\\u306A\\u3089\\u306A\\u3044\\u3088\\u3046\\u306B\\u3059\\u308B\\u3053\\u3068\\u3082\\u6709\\u52B9\\u3067\\u3059\\u3002\"), mdx(\"h4\", {\n    \"id\": \"workfload-identity\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#workfload-identity\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), \"Workfload Identity\"), mdx(\"p\", null, \"GKE \\u5185\\u3067 GCP \\u306E SA \\u3092\\u5229\\u7528\\u3057\\u305F\\u3044\\u5834\\u5408\\u3001 \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://cloud.google.com/kubernetes-engine/docs/how-to/workload-identity\"\n  }), \"Workflow Identity\"), \" \\u306E\\u4ED5\\u7D44\\u307F\\u3092\\u5229\\u7528\\u3059\\u308B\\u3053\\u3068\\u3067\\u3001\\u30AD\\u30FC\\u306E\\u30C0\\u30A6\\u30F3\\u30ED\\u30FC\\u30C9\\u3092\\u305B\\u305A\\u306B SA \\u3092\\u5229\\u7528\\u3059\\u308B\\u3053\\u3068\\u304C\\u53EF\\u80FD\\u3068\\u306A\\u308A\\u307E\\u3059\\u3002\\u5177\\u4F53\\u7684\\u306B\\u306F\\u3001GCP \\u306E SA \\u3092 Kubernetes \\u306E SA \\u306B\\u7D10\\u3065\\u3051\\u3066\\u3044\\u307E\\u3059\\u3002\"), mdx(\"p\", null, \"AWS \\u306A\\u3069 GCP \\u5916\\u304B\\u3089 SA \\u3092\\u5229\\u7528\\u3059\\u308B\\u5834\\u5408\\u3067\\u3082\\u3001 \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://cloud.google.com/iam/docs/workload-identity-federation\"\n  }), \"Workload identity federation\"), \" \\u306E\\u5229\\u7528\\u304C\\u53EF\\u80FD\\u3067\\u3059\\u3002\"), mdx(\"h4\", {\n    \"id\": \"service-account-impersonation\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#service-account-impersonation\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), \"Service Account Impersonation\"), mdx(\"p\", null, \"\\u30ED\\u30FC\\u30AB\\u30EB\\u306A\\u3069\\u3001Workload Identity \\u3092\\u5229\\u7528\\u3067\\u304D\\u306A\\u3044\\u5834\\u5408\\u3067\\u3082\\u3001\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://cloud.google.com/iam/docs/impersonating-service-accounts\"\n  }), \"Service Account Impersonation\"), \" \\u306B\\u3088\\u308A\\u30AD\\u30FC\\u306E\\u30C0\\u30A6\\u30F3\\u30ED\\u30FC\\u30C9\\u3092\\u56DE\\u907F\\u3067\\u304D\\u307E\\u3059\\u3002\"), mdx(\"p\", null, \"\\u4F8B\\u3048\\u3070 gcloud \\u30B3\\u30DE\\u30F3\\u30C9\\u3067\\u3042\\u308C\\u3070\\u3001\\u4E0A\\u8A18\\u306E\\u30EA\\u30F3\\u30AF\\u306E\\u6A29\\u9650\\u3092\\u4ED8\\u4E0E\\u3057\\u305F\\u5F8C\\u3001 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gloud --impersonate-service-account {SA \\u306E email} ...\"), \" \\u3068\\u3059\\u308B\\u3053\\u3068\\u3067\\u3001\\u305D\\u306E SA \\u306E\\u6A29\\u9650\\u306B\\u304A\\u3044\\u3066\\u30B3\\u30DE\\u30F3\\u30C9\\u3092\\u5B9F\\u884C\\u3067\\u304D\\u307E\\u3059\\u3002\"), mdx(\"h2\", {\n    \"id\": \"ダウンロードを回避できない場合\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%82%92%E5%9B%9E%E9%81%BF%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), \"\\u30C0\\u30A6\\u30F3\\u30ED\\u30FC\\u30C9\\u3092\\u56DE\\u907F\\u3067\\u304D\\u306A\\u3044\\u5834\\u5408\"), mdx(\"p\", null, \"\\u4F8B\\u3048\\u3070 SaaS \\u304B\\u3089 GCP \\u30EA\\u30BD\\u30FC\\u30B9\\u3092\\u64CD\\u4F5C\\u3055\\u305B\\u308B\\u5834\\u5408\\u3001\\u30AD\\u30FC\\u306E\\u30C0\\u30A6\\u30F3\\u30ED\\u30FC\\u30C9\\u304C\\u5FC5\\u9808\\u306B\\u306A\\u3063\\u3066\\u3057\\u307E\\u3046\\u30B1\\u30FC\\u30B9\\u306F\\u5B58\\u5728\\u3057\\u307E\\u3059\\u3002\"), mdx(\"p\", null, \"\\u3053\\u3046\\u3044\\u3063\\u305F\\u5834\\u5408\\u3067\\u3082\\u3001\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"roles/iam.serviceAccountKeyAdmin\"), \" \\u3092\\u4ED8\\u4E0E\\u3059\\u308B\\u30E6\\u30FC\\u30B6\\u30FC\\u3092\\u9650\\u5B9A\\u3059\\u308B\\u306A\\u3069\\u306B\\u3088\\u308A\\u3001\\u7121\\u95C7\\u306A\\u30C0\\u30A6\\u30F3\\u30ED\\u30FC\\u30C9\\u3092\\u9632\\u304E\\u307E\\u3057\\u3087\\u3046\\u3002\"), mdx(\"h1\", {\n    \"id\": \"2-compute-engine-default-service-account-を利用\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h1\"\n  }, {\n    \"href\": \"#2-compute-engine-default-service-account-%E3%82%92%E5%88%A9%E7%94%A8\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), \"(2) Compute Engine Default Service Account \\u3092\\u5229\\u7528\"), mdx(\"p\", null, \"Compute Engine \\u306E API \\u3092\\u6709\\u52B9\\u5316\\u3059\\u308B\\u3068\\u3001 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"PROJECT_NUMBER-compute@developer.gserviceaccount.com\"), \" \\u306E\\u3088\\u3046\\u306A SA \\u304C\\u81EA\\u52D5\\u3067\\u4F5C\\u6210\\u3055\\u308C\\u307E\\u3059\\u3002\"), mdx(\"p\", null, \"\\u3053\\u306E SA \\u306F Cloud Composer \\u3084 Dataflow \\u3068\\u3044\\u3063\\u305F\\u3001Compute Engine \\u3092\\u30B5\\u30FC\\u30D3\\u30B9\\u306E\\u4E00\\u90E8\\u3068\\u3057\\u3066\\u5229\\u7528\\u3059\\u308B\\u30B5\\u30FC\\u30D3\\u30B9\\u306B\\u304A\\u3044\\u3066\\u3082\\u5229\\u7528\\u3055\\u308C\\u307E\\u3059\\u3002\"), mdx(\"h2\", {\n    \"id\": \"何が問題か？-1\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#%E4%BD%95%E3%81%8C%E5%95%8F%E9%A1%8C%E3%81%8B%EF%BC%9F-1\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), \"\\u4F55\\u304C\\u554F\\u984C\\u304B\\uFF1F\"), mdx(\"p\", null, \"\\u3053\\u306E SA \\u306F \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"roles/editor\"), \" \\u3068\\u3044\\u3046\\u5F37\\u3044\\u6A29\\u9650\\u3092\\u30D7\\u30ED\\u30B8\\u30A7\\u30AF\\u30C8\\u30EC\\u30D9\\u30EB\\u3067\\u6301\\u3063\\u3066\\u3044\\u307E\\u3059\\u3002\"), mdx(\"p\", null, \"\\u7279\\u5B9A\\u306E\\u7528\\u9014\\u306B\\u306E\\u307F\\u5229\\u7528\\u3059\\u308B\\u5834\\u5408\\u306B\\u306F\\u554F\\u984C\\u3042\\u308A\\u307E\\u305B\\u3093\\u3002\\u3057\\u304B\\u3057\\u3001\\u8907\\u6570\\u306E\\u30A2\\u30D7\\u30EA\\u3084\\u30B5\\u30FC\\u30D3\\u30B9\\u306E\\u914D\\u7F6E\\u306A\\u3069\\u7528\\u9014\\u304C\\u7570\\u306A\\u308B\\u3082\\u306E\\u6DF7\\u5728\\u3055\\u305B\\u308B\\u5834\\u5408\\u3001\\u3053\\u306E SA \\u3092\\u5229\\u7528\\u3057\\u305F Compute Instance \\u304B\\u3089\\u306F\\u307B\\u307C\\u3042\\u3089\\u3086\\u308B\\u30EA\\u30BD\\u30FC\\u30B9\\u306B\\u30A2\\u30AF\\u30BB\\u30B9\\u3067\\u304D\\u3066\\u3057\\u307E\\u3046\\u305F\\u3081\\u3001\\u30AC\\u30D0\\u30CA\\u30F3\\u30B9\\u89B3\\u70B9\\u3067\\u3082\\u671B\\u307E\\u3057\\u304F\\u3042\\u308A\\u307E\\u305B\\u3093\\u3057\\u3001\\u601D\\u308F\\u306C\\u4E8B\\u6545\\u306B\\u3064\\u306A\\u304C\\u308B\\u30EA\\u30B9\\u30AF\\u3082\\u3042\\u308A\\u307E\\u3059\\u3002\"), mdx(\"h2\", {\n    \"id\": \"どうすればよいか？-1\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#%E3%81%A9%E3%81%86%E3%81%99%E3%82%8C%E3%81%B0%E3%82%88%E3%81%84%E3%81%8B%EF%BC%9F-1\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), \"\\u3069\\u3046\\u3059\\u308C\\u3070\\u3088\\u3044\\u304B\\uFF1F\"), mdx(\"p\", null, \"(1) \\u306E\\u5185\\u5BB9\\u306B\\u7E4B\\u304C\\u308A\\u307E\\u3059\\u304C\\u3001\\u30EF\\u30FC\\u30AF\\u30ED\\u30FC\\u30C9\\u3054\\u3068\\u306B\\u6A29\\u9650\\u3092\\u7D5E\\u3063\\u305F SA \\u3092\\u4F5C\\u308A\\u3001\\u8D77\\u52D5\\u6642\\u306B\\u9069\\u5207\\u306A SA \\u3092\\u5229\\u7528\\u3059\\u308B\\u3088\\u3046\\u306B\\u3057\\u307E\\u3057\\u3087\\u3046\\u3002\"), mdx(\"h3\", {\n    \"id\": \"gke-の場合\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#gke-%E3%81%AE%E5%A0%B4%E5%90%88\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), \"GKE \\u306E\\u5834\\u5408\"), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#use_least_privilege_sa\"\n  }), \"\\u3053\\u3061\\u3089\\u306E\\u516C\\u5F0F\\u30C9\\u30AD\\u30E5\\u30E1\\u30F3\\u30C8\"), \"\\u306B\\u3001GKE Standard Cluster \\u3092\\u69CB\\u7BC9\\u3059\\u308B\\u5834\\u5408\\u306B\\u5FC5\\u8981\\u306A\\u30DF\\u30CB\\u30DE\\u30E0\\u306E\\u6A29\\u9650\\u304C\\u7D39\\u4ECB\\u3055\\u308C\\u3066\\u3044\\u307E\\u3059\\u306E\\u3067\\u3001\\u3053\\u306E\\u30AC\\u30A4\\u30C9\\u3092\\u30D9\\u30FC\\u30B9\\u306B SA \\u3092\\u4F5C\\u6210\\u3057\\u307E\\u3057\\u3087\\u3046\\u3002\"), mdx(\"h3\", {\n    \"id\": \"dataflow-dataproc-datafusion-の場合\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#dataflow-dataproc-datafusion-%E3%81%AE%E5%A0%B4%E5%90%88\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), \"Dataflow, DataProc, DataFusion \\u306E\\u5834\\u5408\"), mdx(\"p\", null, \"Dataflow, DataProc, DataFusion \\u306B\\u3064\\u3044\\u3066\\u306F\\u3001Compute Engine Default SA \\u3092 impersonate \\u3059\\u308B\\u6A29\\u9650\\u304C\\u306A\\u3044\\u306B\\u3082\\u95A2\\u308F\\u3089\\u305A\\u3001\\u305D\\u306E\\u6A29\\u9650\\u306B\\u304A\\u3044\\u3066\\u8D77\\u52D5\\u3067\\u304D\\u3066\\u3057\\u307E\\u3046\\u3068\\u3044\\u3046\\u30EC\\u30AC\\u30B7\\u30FC\\u306A\\u6319\\u52D5\\u304C\\u6B8B\\u3063\\u3066\\u3044\\u307E\\u3059\\u3002\"), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://cloud.google.com/iam/docs/service-accounts-actas#dataproc-dataflow-datafusion\"\n  }), \"\\u3053\\u3061\\u3089\\u306E\\u30C9\\u30AD\\u30E5\\u30E1\\u30F3\\u30C8\"), \"\\u3092\\u53C2\\u8003\\u306B\\u3001\\u3053\\u306E\\u3088\\u3046\\u306A\\u306A\\u6319\\u52D5\\u3092\\u30AA\\u30D5\\u306B\\u3059\\u308B\\u3053\\u3068\\u3067\\u3001\\u5B89\\u6613\\u306B Compute Engine Default SA \\u306E\\u5229\\u7528\\u3092\\u9632\\u3050\\u3053\\u3068\\u304C\\u53EF\\u80FD\\u3067\\u3059\\u3002\"), mdx(\"h1\", {\n    \"id\": \"3-適当に-app-engine-を有効化--deploy\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h1\"\n  }, {\n    \"href\": \"#3-%E9%81%A9%E5%BD%93%E3%81%AB-app-engine-%E3%82%92%E6%9C%89%E5%8A%B9%E5%8C%96--deploy\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), \"(3) \\u9069\\u5F53\\u306B App Engine \\u3092\\u6709\\u52B9\\u5316 / Deploy\"), mdx(\"h2\", {\n    \"id\": \"何が問題か？-2\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#%E4%BD%95%E3%81%8C%E5%95%8F%E9%A1%8C%E3%81%8B%EF%BC%9F-2\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), \"\\u4F55\\u304C\\u554F\\u984C\\u304B\\uFF1F\"), mdx(\"h3\", {\n    \"id\": \"app-engine-のリージョンが他のサービスにも不可逆な影響を及ぼす\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#app-engine-%E3%81%AE%E3%83%AA%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%81%8C%E4%BB%96%E3%81%AE%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AB%E3%82%82%E4%B8%8D%E5%8F%AF%E9%80%86%E3%81%AA%E5%BD%B1%E9%9F%BF%E3%82%92%E5%8F%8A%E3%81%BC%E3%81%99\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), \"App Engine \\u306E\\u30EA\\u30FC\\u30B8\\u30E7\\u30F3\\u304C\\u4ED6\\u306E\\u30B5\\u30FC\\u30D3\\u30B9\\u306B\\u3082\\u4E0D\\u53EF\\u9006\\u306A\\u5F71\\u97FF\\u3092\\u53CA\\u307C\\u3059\"), mdx(\"p\", null, \"App Engine \\u3092\\u6709\\u52B9\\u5316\\u3059\\u308B\\u969B\\u306B\\u306F\\u30EA\\u30FC\\u30B8\\u30E7\\u30F3\\u3092\\u9078\\u3073\\u307E\\u3059\\u304C\\u3001\\u4E00\\u5EA6\\u9078\\u3076\\u3068\\u5909\\u66F4\\u3067\\u304D\\u307E\\u305B\\u3093\\u3002\\n\\u305D\\u3057\\u3066\\u3001Cloud Tasks, Cloud Scheduler \\u306A\\u3069\\u3082\\u3053\\u306E\\u30EA\\u30FC\\u30B8\\u30E7\\u30F3\\u306B\\u4F9D\\u5B58\\u3057\\u307E\\u3059\\u3002\"), mdx(\"h3\", {\n    \"id\": \"デフォルトで強力な権限を持った-sa-が利用される\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%81%A7%E5%BC%B7%E5%8A%9B%E3%81%AA%E6%A8%A9%E9%99%90%E3%82%92%E6%8C%81%E3%81%A3%E3%81%9F-sa-%E3%81%8C%E5%88%A9%E7%94%A8%E3%81%95%E3%82%8C%E3%82%8B\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), \"\\u30C7\\u30D5\\u30A9\\u30EB\\u30C8\\u3067\\u5F37\\u529B\\u306A\\u6A29\\u9650\\u3092\\u6301\\u3063\\u305F SA \\u304C\\u5229\\u7528\\u3055\\u308C\\u308B\"), mdx(\"p\", null, \"(2) \\u306E Compute Engine Default SA \\u3068\\u540C\\u3058\\u304F\\u3001 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"roles/editor\"), \" \\u3092\\u30D7\\u30ED\\u30B8\\u30A7\\u30AF\\u30C8\\u30EC\\u30D9\\u30EB\\u3067\\u6301\\u3063\\u305F\\u5F37\\u529B\\u306A SA \\u304C\\u5229\\u7528\\u3055\\u308C\\u307E\\u3059\\u3002\"), mdx(\"p\", null, \"\\u5384\\u4ECB\\u306A\\u306E\\u306F\\u3001\\u4F8B\\u3048\\u3070 Cloud Run \\u306E\\u3088\\u3046\\u306B\\u4EFB\\u610F\\u306E SA \\u3092\\u6307\\u5B9A\\u3057\\u3066\\u30C7\\u30D7\\u30ED\\u30A4\\u3059\\u308B\\u3053\\u3068\\u304C\\u3067\\u304D\\u307E\\u305B\\u3093\\u3002\"), mdx(\"p\", null, \"\\u306A\\u306E\\u3067\\u3001SA \\u3092\\u5909\\u66F4\\u3059\\u308B\\u306E\\u3067\\u306F\\u306A\\u304F\\u3001\\u30C7\\u30D5\\u30A9\\u30EB\\u30C8 SA \\u306E\\u6A29\\u9650\\u3092\\u8ABF\\u6574\\u3059\\u308B\\u3068\\u3044\\u3046\\u65B9\\u6CD5\\u304C\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://cloud.google.com/appengine/docs/standard/python3/service-account\"\n  }), \"\\u3053\\u3061\\u3089\\u306E\\u30C9\\u30AD\\u30E5\\u30E1\\u30F3\\u30C8\"), \"\\u3067\\u7D39\\u4ECB\\u3055\\u308C\\u3066\\u3044\\u307E\\u3059\\u3002\"), mdx(\"h3\", {\n    \"id\": \"どうすればよいか？-2\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#%E3%81%A9%E3%81%86%E3%81%99%E3%82%8C%E3%81%B0%E3%82%88%E3%81%84%E3%81%8B%EF%BC%9F-2\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), \"\\u3069\\u3046\\u3059\\u308C\\u3070\\u3088\\u3044\\u304B\\uFF1F\"), mdx(\"p\", null, \"App Engine \\u3092\\u4F7F\\u3044\\u305F\\u3044\\u306E\\u3067\\u3042\\u308C\\u3070\\u3001\\u30EA\\u30FC\\u30B8\\u30E7\\u30F3\\u306F\\u614E\\u91CD\\u306B\\u9078\\u629E\\u3057\\u307E\\u3057\\u3087\\u3046\\u3002\\u4F7F\\u3063\\u3066\\u307F\\u305F\\u3044\\u3060\\u3051\\u3067\\u3042\\u308C\\u3070\\u3001\\u30B5\\u30F3\\u30C9\\u30DC\\u30C3\\u30AF\\u30B9\\u7528\\u306E\\u30D7\\u30ED\\u30B8\\u30A7\\u30AF\\u30C8\\u306A\\u3069\\u3001\\u6F70\\u3057\\u3066\\u3082\\u826F\\u3044\\u30D7\\u30ED\\u30B8\\u30A7\\u30AF\\u30C8\\u3092\\u9078\\u3073\\u307E\\u3057\\u3087\\u3046\\u3002\"), mdx(\"p\", null, \"\\u307E\\u305F\\u3001\\u73FE\\u5728\\u3067\\u3042\\u308C\\u3070 Cloud Run \\u3082\\u3001App Engine \\u4E26\\u306E\\u624B\\u8EFD\\u3055\\u3068\\u4F4E\\u30B3\\u30B9\\u30C8\\u3067\\u30A2\\u30D7\\u30EA\\u30B1\\u30FC\\u30B7\\u30E7\\u30F3\\u306E\\u904B\\u7528\\u304C\\u3067\\u304D\\u308B\\u306E\\u3067\\u30AA\\u30B9\\u30B9\\u30E1\\u3067\\u3059\\u3002\"), mdx(\"hr\", null), mdx(\"p\", null, \"\\u4EE5\\u4E0A\\u3001GCP \\u3067\\u5B9F\\u884C\\u524D\\u306B\\u6C17\\u3092\\u3064\\u3051\\u305F\\u3044 3 \\u3064\\u306E\\u3053\\u3068\\u306E\\u7D39\\u4ECB\\u3067\\u3057\\u305F\\u3002\"));\n}\n\n;\nMDXContent.isMDXComponent = true;","renderedOutput":"\u003ch1 id=\"about\"\u003e\u003ca href=\"#about\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eAbout\u003c/h1\u003e\u003cp\u003eGCP で、実行前に気をつけたい 3 つの機能を紹介します。\u003c/p\u003e\u003cp\u003e元ネタは、同僚の \u003ca href=\"https://twitter.com/sakajunquality\"\u003e@sakajunquality\u003c/a\u003e が社内用に作ったドキュメントです。\n内容がとても良かったので、本人に許可を取った上で加筆修正し、公開しています。\u003c/p\u003e\u003ch1 id=\"tldr\"\u003e\u003ca href=\"#tldr\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eTL;DR\u003c/h1\u003e\u003cp\u003eGCP では、以下 3 つの作業に注意しましょう\u003c/p\u003e\u003col\u003e\u003cli\u003eService Account のクレデンシャルダウンロード。対策として、そもそもダウンロードしなければいけない機会を減らしましょう。また、権限を適切に絞りましょう\u003c/li\u003e\u003cli\u003eCompute Engine Default Service Accont の利用。対策として、専用の Service Account を用意しましょう\u003c/li\u003e\u003cli\u003eApp Engine の有効化。有効化する際はリージョンに気をつけましょう。なんとなく有効化するのはやめましょう\u003c/li\u003e\u003c/ol\u003e\u003ch1 id=\"1-service-account-key-のダウンロード\"\u003e\u003ca href=\"#1-service-account-key-%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e(1) Service Account Key のダウンロード\u003c/h1\u003e\u003cp\u003eGCP では以下のように ServiceAccount (以下、SA) の Key をダウンロードし、その SA を使うことができます。\u003c/p\u003e\u003cp\u003e\u003ca href=\"https://cloud.google.com/iam/docs/creating-managing-service-account-keys#creating_service_account_keys\"\u003e公式 Doc\u003c/a\u003e\u003c/p\u003e\u003ch2 id=\"何が問題か？\"\u003e\u003ca href=\"#%E4%BD%95%E3%81%8C%E5%95%8F%E9%A1%8C%E3%81%8B%EF%BC%9F\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e何が問題か？\u003c/h2\u003e\u003cp\u003e特にローカル端末へのダウンロードは、権限の管理が難しくする要因となります。\n結果として、例えば以下のようなリスクが出てきます。\u003c/p\u003e\u003cul\u003e\u003cli\u003eローカルから外部への流出（例：自分の Public Repostiory に上げちゃいました）\u003c/li\u003e\u003cli\u003eダウンロードしたメンバーが退職した際のローテート\u003c/li\u003e\u003c/ul\u003e\u003cp\u003eSA に \u003ccode\u003eProject Editor\u003c/code\u003e や \u003ccode\u003eProject Owner\u003c/code\u003e のような非常に強い権限が付与されている場合、リスクは大きくなります。\u003c/p\u003e\u003ch2 id=\"どうすればよいか？\"\u003e\u003ca href=\"#%E3%81%A9%E3%81%86%E3%81%99%E3%82%8C%E3%81%B0%E3%82%88%E3%81%84%E3%81%8B%EF%BC%9F\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eどうすればよいか？\u003c/h2\u003e\u003ch3 id=\"権限を絞る\"\u003e\u003ca href=\"#%E6%A8%A9%E9%99%90%E3%82%92%E7%B5%9E%E3%82%8B\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e権限を絞る\u003c/h3\u003e\u003cp\u003e各 SA に、用途に応じた最小限の権限を設定しましょう。面倒くさがって \u003ccode\u003eProject Editor\u003c/code\u003e や \u003ccode\u003eProject Owner\u003c/code\u003e をとりあえずつけてしまうのは NG です。\u003c/p\u003e\u003cp\u003eまた、Terraform を利用することで、権限が必要な文脈やこれまでの経緯などが残ったり、PR ベースの権限付与が可能となるのででオススメです。\u003c/p\u003e\u003cp\u003e\u003ca href=\"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam\"\u003egoogle_project_iam\u003c/a\u003e\u003c/p\u003e\u003ch3 id=\"キーのダウンロードを不要にする\"\u003e\u003ca href=\"#%E3%82%AD%E3%83%BC%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%82%92%E4%B8%8D%E8%A6%81%E3%81%AB%E3%81%99%E3%82%8B\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eキーのダウンロードを不要にする\u003c/h3\u003e\u003cp\u003eそもそもキーが必要とならないようにすることも有効です。\u003c/p\u003e\u003ch4 id=\"workfload-identity\"\u003e\u003ca href=\"#workfload-identity\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eWorkfload Identity\u003c/h4\u003e\u003cp\u003eGKE 内で GCP の SA を利用したい場合、 \u003ca href=\"https://cloud.google.com/kubernetes-engine/docs/how-to/workload-identity\"\u003eWorkflow Identity\u003c/a\u003e の仕組みを利用することで、キーのダウンロードをせずに SA を利用することが可能となります。具体的には、GCP の SA を Kubernetes の SA に紐づけています。\u003c/p\u003e\u003cp\u003eAWS など GCP 外から SA を利用する場合でも、 \u003ca href=\"https://cloud.google.com/iam/docs/workload-identity-federation\"\u003eWorkload identity federation\u003c/a\u003e の利用が可能です。\u003c/p\u003e\u003ch4 id=\"service-account-impersonation\"\u003e\u003ca href=\"#service-account-impersonation\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eService Account Impersonation\u003c/h4\u003e\u003cp\u003eローカルなど、Workload Identity を利用できない場合でも、\u003ca href=\"https://cloud.google.com/iam/docs/impersonating-service-accounts\"\u003eService Account Impersonation\u003c/a\u003e によりキーのダウンロードを回避できます。\u003c/p\u003e\u003cp\u003e例えば gcloud コマンドであれば、上記のリンクの権限を付与した後、 \u003ccode\u003egloud --impersonate-service-account {SA の email} ...\u003c/code\u003e とすることで、その SA の権限においてコマンドを実行できます。\u003c/p\u003e\u003ch2 id=\"ダウンロードを回避できない場合\"\u003e\u003ca href=\"#%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%82%92%E5%9B%9E%E9%81%BF%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eダウンロードを回避できない場合\u003c/h2\u003e\u003cp\u003e例えば SaaS から GCP リソースを操作させる場合、キーのダウンロードが必須になってしまうケースは存在します。\u003c/p\u003e\u003cp\u003eこういった場合でも、\u003ccode\u003eroles/iam.serviceAccountKeyAdmin\u003c/code\u003e を付与するユーザーを限定するなどにより、無闇なダウンロードを防ぎましょう。\u003c/p\u003e\u003ch1 id=\"2-compute-engine-default-service-account-を利用\"\u003e\u003ca href=\"#2-compute-engine-default-service-account-%E3%82%92%E5%88%A9%E7%94%A8\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e(2) Compute Engine Default Service Account を利用\u003c/h1\u003e\u003cp\u003eCompute Engine の API を有効化すると、 \u003ccode\u003ePROJECT_NUMBER-compute@developer.gserviceaccount.com\u003c/code\u003e のような SA が自動で作成されます。\u003c/p\u003e\u003cp\u003eこの SA は Cloud Composer や Dataflow といった、Compute Engine をサービスの一部として利用するサービスにおいても利用されます。\u003c/p\u003e\u003ch2 id=\"何が問題か？-1\"\u003e\u003ca href=\"#%E4%BD%95%E3%81%8C%E5%95%8F%E9%A1%8C%E3%81%8B%EF%BC%9F-1\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e何が問題か？\u003c/h2\u003e\u003cp\u003eこの SA は \u003ccode\u003eroles/editor\u003c/code\u003e という強い権限をプロジェクトレベルで持っています。\u003c/p\u003e\u003cp\u003e特定の用途にのみ利用する場合には問題ありません。しかし、複数のアプリやサービスの配置など用途が異なるもの混在させる場合、この SA を利用した Compute Instance からはほぼあらゆるリソースにアクセスできてしまうため、ガバナンス観点でも望ましくありませんし、思わぬ事故につながるリスクもあります。\u003c/p\u003e\u003ch2 id=\"どうすればよいか？-1\"\u003e\u003ca href=\"#%E3%81%A9%E3%81%86%E3%81%99%E3%82%8C%E3%81%B0%E3%82%88%E3%81%84%E3%81%8B%EF%BC%9F-1\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eどうすればよいか？\u003c/h2\u003e\u003cp\u003e(1) の内容に繋がりますが、ワークロードごとに権限を絞った SA を作り、起動時に適切な SA を利用するようにしましょう。\u003c/p\u003e\u003ch3 id=\"gke-の場合\"\u003e\u003ca href=\"#gke-%E3%81%AE%E5%A0%B4%E5%90%88\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eGKE の場合\u003c/h3\u003e\u003cp\u003e\u003ca href=\"https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#use_least_privilege_sa\"\u003eこちらの公式ドキュメント\u003c/a\u003eに、GKE Standard Cluster を構築する場合に必要なミニマムの権限が紹介されていますので、このガイドをベースに SA を作成しましょう。\u003c/p\u003e\u003ch3 id=\"dataflow-dataproc-datafusion-の場合\"\u003e\u003ca href=\"#dataflow-dataproc-datafusion-%E3%81%AE%E5%A0%B4%E5%90%88\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eDataflow, DataProc, DataFusion の場合\u003c/h3\u003e\u003cp\u003eDataflow, DataProc, DataFusion については、Compute Engine Default SA を impersonate する権限がないにも関わらず、その権限において起動できてしまうというレガシーな挙動が残っています。\u003c/p\u003e\u003cp\u003e\u003ca href=\"https://cloud.google.com/iam/docs/service-accounts-actas#dataproc-dataflow-datafusion\"\u003eこちらのドキュメント\u003c/a\u003eを参考に、このようなな挙動をオフにすることで、安易に Compute Engine Default SA の利用を防ぐことが可能です。\u003c/p\u003e\u003ch1 id=\"3-適当に-app-engine-を有効化--deploy\"\u003e\u003ca href=\"#3-%E9%81%A9%E5%BD%93%E3%81%AB-app-engine-%E3%82%92%E6%9C%89%E5%8A%B9%E5%8C%96--deploy\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e(3) 適当に App Engine を有効化 / Deploy\u003c/h1\u003e\u003ch2 id=\"何が問題か？-2\"\u003e\u003ca href=\"#%E4%BD%95%E3%81%8C%E5%95%8F%E9%A1%8C%E3%81%8B%EF%BC%9F-2\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e何が問題か？\u003c/h2\u003e\u003ch3 id=\"app-engine-のリージョンが他のサービスにも不可逆な影響を及ぼす\"\u003e\u003ca href=\"#app-engine-%E3%81%AE%E3%83%AA%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%81%8C%E4%BB%96%E3%81%AE%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AB%E3%82%82%E4%B8%8D%E5%8F%AF%E9%80%86%E3%81%AA%E5%BD%B1%E9%9F%BF%E3%82%92%E5%8F%8A%E3%81%BC%E3%81%99\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eApp Engine のリージョンが他のサービスにも不可逆な影響を及ぼす\u003c/h3\u003e\u003cp\u003eApp Engine を有効化する際にはリージョンを選びますが、一度選ぶと変更できません。\nそして、Cloud Tasks, Cloud Scheduler などもこのリージョンに依存します。\u003c/p\u003e\u003ch3 id=\"デフォルトで強力な権限を持った-sa-が利用される\"\u003e\u003ca href=\"#%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%81%A7%E5%BC%B7%E5%8A%9B%E3%81%AA%E6%A8%A9%E9%99%90%E3%82%92%E6%8C%81%E3%81%A3%E3%81%9F-sa-%E3%81%8C%E5%88%A9%E7%94%A8%E3%81%95%E3%82%8C%E3%82%8B\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eデフォルトで強力な権限を持った SA が利用される\u003c/h3\u003e\u003cp\u003e(2) の Compute Engine Default SA と同じく、 \u003ccode\u003eroles/editor\u003c/code\u003e をプロジェクトレベルで持った強力な SA が利用されます。\u003c/p\u003e\u003cp\u003e厄介なのは、例えば Cloud Run のように任意の SA を指定してデプロイすることができません。\u003c/p\u003e\u003cp\u003eなので、SA を変更するのではなく、デフォルト SA の権限を調整するという方法が\u003ca href=\"https://cloud.google.com/appengine/docs/standard/python3/service-account\"\u003eこちらのドキュメント\u003c/a\u003eで紹介されています。\u003c/p\u003e\u003ch3 id=\"どうすればよいか？-2\"\u003e\u003ca href=\"#%E3%81%A9%E3%81%86%E3%81%99%E3%82%8C%E3%81%B0%E3%82%88%E3%81%84%E3%81%8B%EF%BC%9F-2\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eどうすればよいか？\u003c/h3\u003e\u003cp\u003eApp Engine を使いたいのであれば、リージョンは慎重に選択しましょう。使ってみたいだけであれば、サンドボックス用のプロジェクトなど、潰しても良いプロジェクトを選びましょう。\u003c/p\u003e\u003cp\u003eまた、現在であれば Cloud Run も、App Engine 並の手軽さと低コストでアプリケーションの運用ができるのでオススメです。\u003c/p\u003e\u003chr/\u003e\u003cp\u003e以上、GCP で実行前に気をつけたい 3 つのことの紹介でした。\u003c/p\u003e","scope":{}},"frontMatter":{"wordCount":297,"readingTime":{"text":"2 min read","minutes":1.475,"time":88500,"words":295},"slug":"gcp-three-things","fileName":"gcp-three-things.mdx","title":"GCPで、適当に実行すべきでない3つのコト","date":"2021-07-07","draft":false,"summary":"GCPで、実行前に立ち止まって考えたい3つの事についてまとめました。","tags":["tech","gcp"]}},"prev":{"title":"Data Meshとは何か？","date":"2021-06-08","draft":false,"summary":"Data Meshについての解説記事です。","tags":["data","tech","datamesh"],"slug":"what-is-datamesh"},"next":{"title":"FastAPIを使っていなくても、Pydanticは便利です","date":"2021-09-06","draft":false,"summary":"pydanticの便利な機能の紹介です。","tags":["tech","python","pydantic"],"slug":"pydantic-intro"}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"gcp-three-things"},"buildId":"ATrmjHqk0Gt4aq76vBxry","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-3cb8f7ab5d3930a1a759.js"></script><script src="/_next/static/chunks/main-a837451738e9bc430433.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/commons.3001023d071dd3bbe4b7.js" async=""></script><script src="/_next/static/chunks/26ad184ddc2343b861b9bcedad5ceb01b11d41f7.9fbf4a83f1e2236cbcd2.js" async=""></script><script src="/_next/static/chunks/a438ddfc9656e71378afc75153a3af52615c85dc.b8ba261f8bcc605c9ae9.js" async=""></script><script src="/_next/static/chunks/c9787b2e67d04485ea556b79e503c7f6cc1ff4d5.2f5b2218d060fcd58c6c.js" async=""></script><script src="/_next/static/chunks/pages/_app-b754ef2746e4a2a0470e.js" async=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-52f3b409457246020eb7.js" async=""></script><script src="/_next/static/ATrmjHqk0Gt4aq76vBxry/_buildManifest.js" async=""></script><script src="/_next/static/ATrmjHqk0Gt4aq76vBxry/_ssgManifest.js" async=""></script></body></html>